<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWM3 Deployment Diagnostic</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .btn { display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Deployment Diagnostic Tool</h1>
    
    <div class="card">
        <h2>1. Config Check</h2>
        <div id="config-status">Checking...</div>
    </div>

    <div class="card">
        <h2>2. File Availability Check</h2>
        <ul id="file-list">
            <li>Checking app.js...</li>
            <li>Checking login.html...</li>
            <li>Checking css/style.css...</li>
        </ul>
    </div>

    <div class="card">
        <h2>3. API Connectivity</h2>
        <div id="api-status">Waiting for config...</div>
    </div>

    <script>
        // Check 1: Config
        const configStatus = document.getElementById('config-status');
        try {
            // Try to load config.js dynamically
            const script = document.createElement('script');
            script.src = 'config.js';
            script.onload = () => {
                if (window.appConfig && window.appConfig.API_BASE_URL) {
                    configStatus.innerHTML = `<span class="success">PASSED</span>: API URL is ${window.appConfig.API_BASE_URL}`;
                    checkApi(window.appConfig.API_BASE_URL);
                } else {
                    configStatus.innerHTML = `<span class="error">FAILED</span>: config.js loaded but appConfig is missing.`;
                }
            };
            script.onerror = () => {
                 configStatus.innerHTML = `<span class="error">FAILED</span>: Could not load config.js (404 Not Found or MIME error)`;
            };
            document.head.appendChild(script);
        } catch (e) {
            configStatus.innerHTML = `<span class="error">ERROR</span>: ${e.message}`;
        }

        // Check 2: Files
        const filesToCheck = [
            { path: 'app.js', type: 'script' },
            { path: 'login.html', type: 'page' },
            { path: 'courses.html', type: 'page' },
            { path: 'css/style.css', type: 'style' }
        ];

        const fileList = document.getElementById('file-list');
        fileList.innerHTML = '';

        filesToCheck.forEach(file => {
            const li = document.createElement('li');
            li.textContent = `Checking ${file.path}...`;
            fileList.appendChild(li);

            fetch(file.path, { method: 'HEAD' })
                .then(res => {
                    if (res.ok) {
                        if (res.headers.get('content-type') && res.headers.get('content-type').includes('text/html') && file.type === 'script') {
                             li.innerHTML = `${file.path}: <span class="error">MIME ERROR</span> (Server returned HTML instead of JS - File likely missing)`;
                        } else {
                             li.innerHTML = `${file.path}: <span class="success">FOUND</span> (${res.status})`;
                        }
                    } else {
                        li.innerHTML = `${file.path}: <span class="error">MISSING</span> (${res.status})`;
                    }
                })
                .catch(err => {
                    li.innerHTML = `${file.path}: <span class="error">NETWORK ERROR</span> (${err.message})`;
                });
        });

        // Check 3: API
        function checkApi(url) {
            const apiStatus = document.getElementById('api-status');
            apiStatus.textContent = `Pinging ${url}...`;
            
            fetch(`${url}/api/courses`)
                .then(res => {
                    if (res.ok || res.status === 404 || res.status === 401) {
                         apiStatus.innerHTML = `<span class="success">CONNECTED</span>: Reached backend (Status: ${res.status})`;
                    } else {
                         apiStatus.innerHTML = `<span class="error">FAILED</span>: Backend returned status ${res.status}`;
                    }
                })
                .catch(err => {
                    apiStatus.innerHTML = `<span class="error">FAILED</span>: Could not reach backend. Check CORS or URL. (${err.message})`;
                });
        }
    </script>
</body>
</html>
